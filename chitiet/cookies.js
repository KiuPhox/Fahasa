//clear Cookies Tesint
// document.cookie = 'giohang = '
getSanPham()

// Object san pham
var product_1 = {
  id: 1,
  name: 'Black Jack - Tập 4 - Tặng Kèm Bookmark Giấy',
  cungcap: 'NXB Trẻ',
  cungcap_url: 'https://google.com',
  nhaxuatban: 'NXB Trẻ',
  tacgia: 'Osamu Tezuka',
  tacgia_url: 'https://google.com',
  hinhthuc: 'Bìa Mềm',
  bo: 'Black Jack',
  bo_url: 'https://google.com',
  gia: 30000,
  hinh_big:
    'https://cdn0.fahasa.com/media/catalog/product/cache/1/small_image/600x600/9df78eab33525d08d6e5fb8d27136e95/n/x/nxbtre_full_15082021_100859.jpg',
  hinh_small_1:
    'https://cdn0.fahasa.com/media/catalog/product/n/x/nxbtre_full_15082021_100859.jpg',
  hinh_small_2:
    'https://cdn0.fahasa.com/media/catalog/product/n/x/nxbtre_full_15082021_100859.jpg',
  hinh_small_3:
    'https://cdn0.fahasa.com/media/catalog/product/n/x/nxbtre_full_15082021_100859.jpg',
  hinh_small_4:
    'https://cdn0.fahasa.com/media/catalog/product/n/x/nxbtre_full_15082021_100859.jpg',
  mahang: '8934974175049',
  namxuatban: '	2021',
  ngonngu: 'Tiếng Việt',
  trongluong: '200',
  kichthuoc: '17.6 x 11.3 cm',
  sotrang: '200',
  sanphamhienthitrong: 'Đồ Chơi Cho Bé - Giá Cực Tốt',
}
var product_2 = {
  id: 2,
  name: 'Black Jack - Tập 3 - Bìa Cứng - Tặng Kèm Bookmark Nhựa',
  cungcap: 'NXB Trẻ',
  cungcap_url: 'https://google.com',
  nhaxuatban: 'NXB Trẻ',
  tacgia: 'Osamu Tezuka',
  tacgia_url: 'https://google.com',
  hinhthuc: 'Bìa Cứng',
  bo: 'Black Jack',
  bo_url: 'https://google.com',
  gia: 121500,
  hinh_big:
    'https://cdn0.fahasa.com/media/catalog/product/cache/1/small_image/600x600/9df78eab33525d08d6e5fb8d27136e95/n/x/nxbtre_full_18082021_100813.jpg',
  hinh_small_1:
    'https://cdn0.fahasa.com/media/catalog/product/n/x/nxbtre_full_18082021_100813.jpg',
  hinh_small_2:
    'https://cdn0.fahasa.com/media/catalog/product/n/x/nxbtre_full_18082021_100813.jpg',
  hinh_small_3:
    'https://cdn0.fahasa.com/media/catalog/product/n/x/nxbtre_full_18082021_100813.jpg',
  hinh_small_4:
    'https://cdn0.fahasa.com/media/catalog/product/n/x/nxbtre_full_18082021_100813.jpg',
  mahang: '8934974174820',
  namxuatban: '	2021',
  ngonngu: 'Tiếng Việt',
  trongluong: '200',
  kichthuoc: '17.6 x 11.3 cm',
  sotrang: '200',
  sanphamhienthitrong: 'Đồ Chơi Cho Bé - Giá Cực Tốt',
}
var product_3 = {
  id: 3,
  name: 'Black Jack - Tập 2 - Bìa Cứng - Tặng Kèm Bookmark Nhựa',
  cungcap: 'NXB Trẻ',
  cungcap_url: 'https://google.com',
  nhaxuatban: 'NXB Trẻ',
  tacgia: 'Osamu Tezuka',
  tacgia_url: 'https://google.com',
  hinhthuc: 'Bìa Cứng',
  bo: 'Black Jack',
  bo_url: 'https://google.com',
  gia: 121500,
  hinh_big:
    'https://cdn0.fahasa.com/media/catalog/product/cache/1/small_image/600x600/9df78eab33525d08d6e5fb8d27136e95/n/x/nxbtre_full_20392021_033905_1.jpg',
  hinh_small_1:
    'https://cdn0.fahasa.com/media/catalog/product/n/x/nxbtre_full_20392021_033905_1.jpg',
  hinh_small_2:
    'https://cdn0.fahasa.com/media/catalog/product/n/x/nxbtre_full_20392021_033905_1.jpg',
  hinh_small_3:
    'https://cdn0.fahasa.com/media/catalog/product/n/x/nxbtre_full_20392021_033905_1.jpg',
  hinh_small_4:
    'https://cdn0.fahasa.com/media/catalog/product/n/x/nxbtre_full_20392021_033905_1.jpg',
  mahang: '8934974174684',
  namxuatban: '	2021',
  ngonngu: 'Tiếng Việt',
  trongluong: '200',
  kichthuoc: '17.6 x 11.3 cm',
  sotrang: '200',
  sanphamhienthitrong: 'Nhập Hội Manga - Comic',
}
var product_4 = {
  id: 4,
  name: 'Black Jack - Tập 1 - Bản Đặc Biệt - Bìa Cứng - Tặng Kèm Bookmark Nhựa + Poster + Khẩu Trang Black Jack',
  cungcap: 'NXB Trẻ',
  cungcap_url: 'https://google.com',
  nhaxuatban: 'NXB Trẻ',
  tacgia: 'Osamu Tezuka',
  tacgia_url: 'https://google.com',
  hinhthuc: 'Bìa Mềm',
  bo: 'Black Jack',
  bo_url: 'https://google.com',
  gia: 130000,
  hinh_big:
    'https://cdn0.fahasa.com/media/catalog/product/cache/1/small_image/600x600/9df78eab33525d08d6e5fb8d27136e95/6/0/600black-jackdb.jpg',
  hinh_small_1:
    'https://cdn0.fahasa.com/media/catalog/product/6/0/600black-jackdb.jpg',
  hinh_small_2:
    'https://cdn0.fahasa.com/media/catalog/product/b/l/black-jack_ao_1_crop_1_1.jpg',
  hinh_small_3:
    'https://cdn0.fahasa.com/media/catalog/product/b/o/bookmark_black-jack.jpg',
  hinh_small_4:
    'https://cdn0.fahasa.com/media/catalog/product/p/o/poster_black-jack_1.jpg',
  mahang: '8934974174318-qt',
  namxuatban: '	2021',
  ngonngu: 'Tiếng Việt',
  trongluong: '200',
  kichthuoc: '20 x 14 cm',
  sotrang: '200',
  sanphamhienthitrong: 'Bộ: Black Jack',
}
var product_5 = {
  id: 5,
  name: 'Bách Quỷ Dạ Hành Ký - Tập 27 - Tặng Kèm Postcard',
  cungcap: 'Nhà Xuất Bản Kim Đồng',
  cungcap_url: 'https://google.com',
  nhaxuatban: 'NXB Kim Đồng',
  tacgia: 'Ichiko IMA',
  tacgia_url: 'https://google.com',
  hinhthuc: 'Bìa Mềm',
  bo: 'Bách Quỷ Dạ Hành Ký',
  bo_url: 'https://google.com',
  gia: 28000,
  hinh_big:
    'https://cdn0.fahasa.com/media/catalog/product/cache/1/small_image/600x600/9df78eab33525d08d6e5fb8d27136e95/b/a/bach-quy-da-hanh-ky_-tap-27_1.jpg',
  hinh_small_1:
    'https://cdn0.fahasa.com/media/catalog/product/b/a/bach-quy-da-hanh-ky_-tap-27_1.jpg',
  hinh_small_2:
    'https://cdn0.fahasa.com/media/catalog/product/b/a/bach_quy_da_hanh_ky__tap_27_1.jpg',
  hinh_small_3:
    'https://cdn0.fahasa.com/media/catalog/product/b/a/bach_quy_da_hanh_ki_-_tap_27__postcard.jpg',
  hinh_small_4:
    'https://cdn0.fahasa.com/media/catalog/product/b/a/bach_quy_da_hanh_ki_-_tap_27__postcard.jpg',
  mahang: '3300000011929',
  namxuatban: '	2021',
  ngonngu: 'Tiếng Việt',
  trongluong: '200',
  kichthuoc: '18 x 13 cm',
  sotrang: '200',
  sanphamhienthitrong: 'Nhà Xuất Bản Kim Đồng',
}
var product_6 = {
  id: 6,
  name: 'Saiki Kusuo - Kẻ Siêu Năng Khốn Khổ - Tập 15: Kẻ Siêu Năng Lạc Trên Hoang Đảo - Tặng Kèm 1 Trong 2 Bảng Sticker Ngẫu Nhiên',
  cungcap: 'Nhà Xuất Bản Kim Đồng',
  cungcap_url: 'https://google.com',
  nhaxuatban: 'NXB Lao Động',
  tacgia: 'Shuichi Aso',
  tacgia_url: 'https://google.com',
  hinhthuc: 'Bìa Mềm',
  bo: 'Saiki Kusuo - Kẻ Siêu Năng Khốn Khổ',
  bo_url: 'https://google.com',
  gia: 22000,
  hinh_big:
    'https://cdn0.fahasa.com/media/catalog/product/cache/1/small_image/600x600/9df78eab33525d08d6e5fb8d27136e95/s/a/saiki-kusuo---ke-sieu-nang-kho-kho---tap-15_1.jpg',
  hinh_small_1:
    'https://cdn0.fahasa.com/media/catalog/product/s/a/saiki-kusuo---ke-sieu-nang-kho-kho---tap-15_1.jpg',
  hinh_small_2:
    'https://cdn0.fahasa.com/media/catalog/product/s/a/saiki_kusuo_-_ke_sieu_nang_kho_kho_-_tap_15_1.jpg',
  hinh_small_3:
    'https://cdn0.fahasa.com/media/catalog/product/s/a/saiki_kusuo_-_ke_sieu_nang_kho_kho_-_tap_15__qua_tang_sticker_mau_2.jpg',
  hinh_small_4:
    'https://cdn0.fahasa.com/media/catalog/product/s/a/saiki_kusuo_-_ke_sieu_nang_kho_kho_-_tap_15__qua_tang_sticker_mau_1.jpg',
  mahang: '3300000012056',
  namxuatban: '	2021',
  ngonngu: 'Tiếng Việt',
  trongluong: '200',
  kichthuoc: '17.6 x 11.3 cm',
  sotrang: '192',
  sanphamhienthitrong: 'Nhà Xuất Bản Kim Đồng',
}
var product_7 = {
  id: 7,
  name: 'Ranma 1/2 - Tập 13',
  cungcap: 'NXB Trẻ',
  cungcap_url: 'https://google.com',
  nhaxuatban: 'NXB Trẻ',
  tacgia: 'Rumiko Takahashi',
  tacgia_url: 'https://google.com',
  hinhthuc: 'Bìa Mềm',
  bo: 'Ranma 1/2',
  bo_url: 'https://google.com',
  gia: 70000,
  hinh_big:
    'https://cdn0.fahasa.com/media/catalog/product/cache/1/small_image/600x600/9df78eab33525d08d6e5fb8d27136e95/n/x/nxbtre_full_15122021_101259.jpg',
  hinh_small_1:
    'https://cdn0.fahasa.com/media/catalog/product/n/x/nxbtre_full_15122021_101259.jpg',
  hinh_small_2:
    'https://cdn0.fahasa.com/media/catalog/product/n/x/nxbtrefull_15122021_101259.jpg',
  hinh_small_3:
    'https://cdn0.fahasa.com/media/catalog/product/n/x/nxbtrefull_15122021_101259.jpg',
  hinh_small_4:
    'https://cdn0.fahasa.com/media/catalog/product/n/x/nxbtrefull_15122021_101259.jpg',
  mahang: '8934974175063',
  namxuatban: '	2021',
  ngonngu: 'Tiếng Việt',
  trongluong: '	263',
  kichthuoc: '	18 x 13 cm',
  sotrang: '344',
  sanphamhienthitrong:
    'MUA SẮM AN TOÀN NGÀN DEAL GIẢM SỐC - Giảm Khủng Đến 60%',
}
var product_8 = {
  id: 8,
  name: 'Đạo Làm Chồng Đảm - Tập 5 - Tặng Kèm Standee PVC',
  cungcap: 'Nhà Xuất Bản Kim Đồng',
  cungcap_url: 'https://google.com',
  nhaxuatban: 'NXB Kim Đồng',
  tacgia: 'Kousuke Oono',
  tacgia_url: 'https://google.com',
  hinhthuc: 'Bìa Mềm',
  bo: 'Đạo Làm Chồng Đảm',
  bo_url: 'https://google.com',
  gia: 30000,
  hinh_big:
    'https://cdn0.fahasa.com/media/catalog/product/cache/1/small_image/600x600/9df78eab33525d08d6e5fb8d27136e95/d/l/dlcd05db.jpg',
  hinh_small_1:
    'https://cdn0.fahasa.com/media/catalog/product/d/l/dlcd05db.jpg',
  hinh_small_2:
    'https://cdn0.fahasa.com/media/catalog/product/d/a/dao_lam_chong_dam_-_tap_5_1.jpg',
  hinh_small_3:
    'https://cdn0.fahasa.com/media/catalog/product/d/a/dao_lam_chong_dam_-_tap_5_-_standee_pvc.jpg',
  hinh_small_4:
    'https://cdn0.fahasa.com/media/catalog/product/d/a/dao_lam_chong_dam_-_tap_5_-_standee_pvc.jpg',
  mahang: '3300000011905',
  namxuatban: '	2021',
  ngonngu: 'Tiếng Việt',
  trongluong: '	200',
  kichthuoc: '	18 x 13 cm',
  sotrang: '160',
  sanphamhienthitrong: 'Đồ Chơi Cho Bé - Giá Cực Tốt',
}
var product_10 = {
  id: 10,
  name: 'Ký Sinh Thú - Tập 1 - Tặng Kèm Postcard',
  cungcap: 'NXB Trẻ',
  cungcap_url: 'https://google.com',
  nhaxuatban: 'NXB Trẻ',
  tacgia: 'Hitoshi Iwaaki',
  tacgia_url: 'https://google.com',
  hinhthuc: 'Bìa Mềm',
  bo: 'Ký Sinh Thú',
  bo_url: 'https://google.com',
  gia: 40500,
  hinh_big:
    'https://cdn0.fahasa.com/media/catalog/product/cache/1/small_image/600x600/9df78eab33525d08d6e5fb8d27136e95/k/_/k_inhthu_1.jpg',
  hinh_small_1:
    'https://cdn0.fahasa.com/media/catalog/product/k/_/k_inhthu_1.jpg',
  hinh_small_2:
    'https://cdn0.fahasa.com/media/catalog/product/k/_/k_inhthu_1.png',
  hinh_small_3:
    'https://cdn0.fahasa.com/media/catalog/product/k/_/k_inhthu_1.png',
  hinh_small_4:
    'https://cdn0.fahasa.com/media/catalog/product/k/_/k_inhthu_1.png',
  mahang: '8934974174127',
  namxuatban: '	2021',
  ngonngu: 'Tiếng Việt',
  trongluong: '	200',
  kichthuoc: '17.6 x 11.3 cm',
  sotrang: '60',
  sanphamhienthitrong: 'Bộ: Ký Sinh Thú',
}
//
var dataa = [
  product_1,
  product_2,
  product_3,
  product_4,
  product_5,
  product_6,
  product_7,
  product_8,
  product_10,
]

//in so
let printNum = (num) => {
  let o = ' đ'
  let c = 0
  if (num < 0) {
    return '0 đ'
  }
  if (String(num).length <= 3) return String(num) + ' đ'
  for (let i = String(num).length - 1; i >= 0; i--) {
    o = String(num)[i] + o
    c++
    if (c == 3 && i != 0) {
      c = 0
      o = '.' + o
    }
  }
  return o
}

// lay cookies
function getCookie(cname) {
  let name = cname + '='
  let decodedCookie = decodeURIComponent(document.cookie)
  let ca = decodedCookie.split(';')
  for (let i = 0; i < ca.length; i++) {
    let c = ca[i]
    while (c.charAt(0) == ' ') {
      c = c.substring(1)
    }
    if (c.indexOf(name) == 0) {
      return c.substring(name.length, c.length)
    }
  }
  return ''
}

//

// Lay san pham tu gio hang (cookies)
function getSanPham() {
  console.log('gettingSP')
  //Tao list san pham
  let ListSanPham = []
  //Check coi co array va san pham nao khong (0 co arr => tao array)
  if (localStorage.giohang === undefined) {
    //luu vao cookie
    localStorage.giohang = `${JSON.stringify(ListSanPham)}`
    return null
  }
  //Neu co san pham gan lai + tra ve ListSanPham
  // ListSanPham = JSON.parse(getCookie('giohang'))
  ListSanPham = JSON.parse(localStorage.giohang)

  console.log(ListSanPham)
  return ListSanPham
}

//Push Thong bao
function PushThongBao(product_obj) {
  let ran_id = Math.random().toString().replace('0.', 'uni_')
  document.querySelector('#thongbaobar').innerHTML += `
    <div
        class="toast"
        data-autohide="true"
        // data-delay="2000"
        id='${ran_id}'
        style="z-index: 9999999999999"
      >
        <div class="toast-header">
          <strong class="mr-auto text-primary" style="color: brown !important"
            >Thêm vào giỏ hàng</strong
          >
          <button type="button" class="ml-2 mb-1 close" data-dismiss="toast">
            &times;
          </button>
        </div>
        <div class="toast-body">Đã thêm ${product_obj.name} vào giỏ hàng</div>
      </div>
  `
  $(document).ready(function () {
    $(`#${ran_id}`).toast('show')
  })
  setTimeout(() => {
    $(document).ready(function () {
      $(`#${ran_id}`).toast('hide')
    })
  }, 2000)
}

//Them SP vao gio hang
function addSanPham(product_id) {
  //get product by ID
  let Selected_product = dataa.filter((item) => item.id === product_id)

  let ListSanPham = getSanPham()
  let tontai = true
  let ListSanPham2
  //Check so luong SP nay` trong gio hang va + so luong
  if (Array(ListSanPham)[0].length >= 1) {
    Array(ListSanPham)[0].map((item) => {
      if (item.name == Selected_product[0].name) {
        item.soluong += 1
        tontai = false
        PushThongBao(Selected_product[0])
      }
    })
  }
  // them sp vao gio hang neu chua co
  if (tontai) {
    Selected_product[0].soluong = 1
    Array(ListSanPham)[0].push(Selected_product[0])
    PushThongBao(Selected_product[0])
  }
  //luu lai vao cookies
  // document.cookie = `giohang=${JSON.stringify(ListSanPham)}`
  localStorage.giohang = `${JSON.stringify(ListSanPham)}`
  return `Added ${Selected_product[0].name}`
}

//Xoa SP khoi gio hang su dung name
function deleteSanPham(product_id) {
  let ListSanPham = getSanPham()
  // them sp vao gio hang

  ListSanPham = Array(ListSanPham)[0].filter((item) => item.id !== product_id)
  //luu lai vao cookies
  // document.cookie = `giohang=${JSON.stringify(ListSanPham)}`
  localStorage.giohang = `${JSON.stringify(ListSanPham)}`
  try {
    LoadSanPham()
  } catch (error) {}
  return `Deleted ${product_id}`
}

//Tang giaam so luong san pham cu the
function TangGiamSoLuong(tang = true, product_id, sl = 0) {
  let ListSanPham = getSanPham()
  if (sl > 0) {
    console.log(1)
    if (Array(ListSanPham)[0].length >= 1) {
      Array(ListSanPham)[0].map((item) => {
        if (item.id == product_id) {
          item.soluong = sl
        }
      })
    }
    localStorage.giohang = `${JSON.stringify(ListSanPham)}`
    LoadSanPham()
    return
  } else if (sl < 0) {
    console.log(1)

    if (Array(ListSanPham)[0].length >= 1) {
      Array(ListSanPham)[0].map((item) => {
        if (item.id == product_id) {
          item.soluong = 1
        }
      })
    }
    localStorage.giohang = `${JSON.stringify(ListSanPham)}`
    LoadSanPham()
    return
  }
  if (Array(ListSanPham)[0].length >= 1) {
    Array(ListSanPham)[0].map((item) => {
      if (item.id == product_id) {
        if (tang == true) {
          item.soluong += 1
        } else {
          console.log(item.soluong)
          if (Number(item.soluong) <= 1) {
            setTimeout(() => {
              deleteSanPham(item.id)
            }, 10)
          }
          item.soluong -= 1
        }
      }
    })
  }
  //luu lai vao cookies
  // document.cookie = `giohang=${JSON.stringify(ListSanPham)}`
  localStorage.giohang = `${JSON.stringify(ListSanPham)}`
  try {
    LoadSanPham()
  } catch (error) {}
  return `${tang == true ? 'Tang' : 'Giam'} ${product_id}`
}
//coupon
function CouponDiscount(coupon_code, task_name) {
  switch (task_name) {
    case 'add':
      break
    case 'remove':
      break
      break
    default:
      break
  }
}
// addSanPham(product_1)
// addSanPham(product_2)
// addSanPham(product_1)
// addSanPham(product_2)
